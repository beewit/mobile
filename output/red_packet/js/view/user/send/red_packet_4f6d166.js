var wecatInit=!1;new Vue({el:"#app",data:{on:"index",nav:{back:"false",title:"发红包",rtext:""},index:0,isLoginAccount:!0,model:{sendName:null,sendPhoto:config.defaultPhoto,randomMoney:1},sendPhotoImage:config.defaultPhoto,joinCouponIds:null,blessings:null,remarks:null,money:1,redPacketCardId:null,redPacketCardName:null,feeMoney:0,couponList:{PageIndex:0,Data:null},cardList:{PageIndex:0,Data:null},selectCouponList:null,expireComponyFunc:!0,Loading:!1,arrayRandomMoney:[{id:1,name:"1元"},{id:3,name:"1~3元"},{id:5,name:"1~5元"},{id:10,name:"1~10元"},{id:20,name:"1~20元"},{id:30,name:"1~30元"},{id:50,name:"1~50元"},{id:100,name:"1~100元"},{id:200,name:"1~200元"}]},mounted:function(){var e=this;wechatSDK.initConfig(["chooseImage","uploadImage","previewImage","chooseWXPay"],function(){wecatInit=!0}),common.getToken(function(t){t?common.getEffectiveFuncById(common.redPacketFuncId,function(){e.expireComponyFunc=common.getRedPacketFuncExpireTime()}):e.isLoginAccount=!1})},methods:{backClick:function(){this.on="index",this.nav.back="false",this.nav.title="发红包"},chooseImage:function(){var e=this;return wecatInit?void wechatSDK.chooseImage(1,function(t){e.model.sendPhoto=t.data.path,e.sendPhotoImage=t.data.url},function(){layer.msg("上传失败",{icon:0})}):void layer.msg("刷新页面重试")},changeRandomMoney:function(e){this.model.randomMoney=e,console.log(event)},tapSelectCoupon:function(e){this.couponList.Data[e].cls?Vue.set(this.couponList.Data[e],"cls",null):Vue.set(this.couponList.Data[e],"cls","active");var t=new Array;for(var e in this.couponList.Data)this.couponList.Data[e].cls&&t.push(this.couponList.Data[e].id);this.joinCouponIds=t.join(",")},submit:function(){console.log(this.model);var e=this;common.ajax({url:config.sendRedPacketUrl,data:e.model,success:function(t){Cookies.set("sendRedPacketName",e.model.sendName,{expires:30}),Cookies.set("sendRedPacketPhoto",e.model.sendPhoto,{expires:30}),wechatSDK.paymentRedPacket(t.data,function(e){e&&(layer.msg("支付成功"),location.href="/red_packet/pages/receive/red_packet.html?id="+t.data)})}})},bindSelectCoupon:function(){var e=this;this.on="coupon",this.nav.back=!0,this.nav.title="选择展示现金券",0==this.couponList.PageIndex&&common.scroll("#content",function(t,a){loadPage=t,e.getCouponList(1,a)},function(t,a){loadPage=t,e.getCouponList(e.couponList.PageIndex+1,a)})},bindSelectRedPacketCard:function(){var e=this;this.on="redpacket",this.nav.back=!0,this.nav.title="选择红包名片",0==this.cardList.PageIndex&&common.scroll("#content",function(t,a){loadPage=t,e.getCardList(1,a)},function(t,a){loadPage=t,e.getCardList(e.cardList.PageIndex+1,a)})},getCouponList:function(e){var t=this;common.ajax({url:config.getCouponListUrl,data:{pageIndex:e},success:function(a){if(1==e)t.couponList=a.data;else{t.couponList.Data.reverse();for(var n in t.couponList.Data)a.data.Data.push(this.couponList.Data[n]);t.couponList.Data.reverse(),a.data.isLoadData=!0,t.couponList=a.data}Vue.set(t,"couponList",t.couponList)}})},getCardList:function(e,t){var a=this;common.ajax({url:config.getRedPacketCardListUrl,data:{pageIndex:e},success:function(n){if(1==e)a.cardList=n.data;else{a.cardList.Data.reverse();for(var o in a.cardList.Data)n.data.Data.push(a.cardList.Data[o]);n.data.Data.reverse(),a.cardList=n.data}setTimeout(function(){"function"==typeof t&&t(n)},500)},error:function(){setTimeout(function(){"function"==typeof t&&t(null)},500)}})},selectCard:function(e,t){var a=this;a.model.redPacketCardId=e,a.redPacketCardName=t,a.on="index",a.nav.back="false",a.nav.title="发红包"}}});