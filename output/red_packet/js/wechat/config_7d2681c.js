var wechatSDK={init:!1,initConfig:function(o,e,n){this.setConfig(o,e,n)},setConfig:function(o,e,n){common.ajax({succTip:!1,url:config.wechatJsSDKConfigUrl,data:{url:location.href},success:function(a){wx.config({debug:!1,appId:a.data.appId,timestamp:a.data.timestamp,nonceStr:a.data.noncestr,signature:a.data.signature,jsApiList:o}),wx.ready(function(){console.log("ready ok "),e&&e()}),wx.error(function(o){console.log("error: "+o),n&&n(o)})}})},chooseImage:function(o,e,n){var a=this;wx.chooseImage({count:o?o:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(o){var c=o.localIds;console.log(o);for(var t=0;t<c.length;t++)a.wxuploadImage(c[t],e,n)},fail:function(o){console.log(o),n&&n("chooseImage error："+o)}})},wxuploadImage:function(o,e,n){var a=this;wx.uploadImage({localId:o,isShowProgressTips:1,success:function(o){var c=o.serverId;a.downloadMedia(c,e,n)},fail:function(o){console.log(o),n&&n("wxuploadImage error："+o)}})},downloadMedia:function(o,e,n){common.ajax({succTip:!1,url:config.wechatMediaDownloadUrl,data:{mediaId:o,dir:"red_packet/wechat"},success:function(o){console.log(o),e&&e(o)},fail:function(o){console.log(o),n&&n("downloadMedia error："+o)}})},paymentRedPacket:function(o,e){var n=this;common.ajax({url:config.payUrl,data:{id:o,type:"微信H5"},success:function(o){n.requestPayment(o,null,e)},error:function(){layer.msg("支付失败",{icon:0})}})},paymentFunc:function(o,e,n){var a=this;common.ajax({url:config.payFuncCreateOrderUrl,data:{body:"开通红包裂变企业版",subject:"开通红包裂变企业版",fcId:e,funcId:o,pt:"微信小程序"},success:function(o){a.requestPayment(o,null,n)},error:function(){layer.msg("支付失败",{icon:0}),"function"==typeof n&&n(!1)}})},paymentOrder:function(o,e){var n=this;common.ajax({url:config.payFuncOrderUrl,data:{body:"开通红包裂变企业版",subject:"开通红包裂变企业版",orderId:o},success:function(o){n.requestPayment(o,"/red_packet/pages/user/open/func.html",e)},error:function(){layer.msg("支付失败",{icon:0}),"function"==typeof e&&e(!1)}})},requestPayment:function(o,e,n){var a=this;wx.chooseWXPay({timestamp:o.data.timeStamp,nonceStr:o.data.noncestr,"package":o.data.package,signType:"MD5",paySign:o.data.sign,success:function(o){console.log("chooseWXPay success："+o),layer.msg("正在检查支付..",{icon:6,time:-1}),a.checkPayment(o.data.tradeNo,e,n)},fail:function(o){alert(JSON.stringify(o)),console.log("chooseWXPay error："+o),layer.msg("支付失败",{icon:0}),"function"==typeof n&&n(!1)}})},checkPayment:function(o,e,n){var a=this;common.ajax({loadTip:!1,errTip:!1,url:config.payCheckUrl,data:{tradeNo:o},success:function(c){alert(JSON.stringify(c));try{200==c.ret?(layer.closeAll(),"function"==typeof n&&n(!0),e&&(location.href=e)):setTimeout(function(){a.checkPayment(o,e)},1e3)}catch(t){alert(JSON.stringify(t))}},error:function(n){alert(JSON.stringify(n));try{setTimeout(function(){a.checkPayment(o,e)},1e3)}catch(c){alert(JSON.stringify(c))}}})}};