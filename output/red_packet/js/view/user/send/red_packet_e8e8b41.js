var wecatInit=!1;new Vue({el:"#app",data:{on:"index",nav:{back:"false",title:"发红包",rtext:""},index:0,isLoginAccount:!0,model:{sendName:null,sendPhoto:config.defaultPhoto,randomMoney:1},sendPhotoImage:config.defaultPhoto,joinCouponIds:null,blessings:null,remarks:null,money:1,redPacketCardId:null,redPacketCardName:null,feeMoney:0,couponList:{PageIndex:0,Data:null},selectCouponList:null,expireComponyFunc:!0,Loading:!1,arrayRandomMoney:[{id:1,name:"1元"},{id:3,name:"1~3元"},{id:5,name:"1~5元"},{id:10,name:"1~10元"},{id:20,name:"1~20元"},{id:30,name:"1~30元"},{id:50,name:"1~50元"},{id:100,name:"1~100元"},{id:200,name:"1~200元"}]},mounted:function(){var e=this;wechatSDK.initConfig(["chooseImage","uploadImage","previewImage","chooseWXPay"],function(){wecatInit=!0}),setTimeout(function(){common.getEffectiveFuncById(common.redPacketFuncId,function(){e.expireComponyFunc=common.getRedPacketFuncExpireTime()})},100)},methods:{backClick:function(){this.on="index",this.nav.back="false",this.nav.title="发红包"},chooseImage:function(){var e=this;return wecatInit?void wechatSDK.chooseImage(1,function(o){e.model.sendPhoto=o.data.path,e.sendPhotoImage=o.data.url},function(){layer.msg("上传失败",{icon:0})}):void layer.msg("刷新页面重试")},changeRandomMoney:function(e){this.model.randomMoney=e,console.log(event)},tapSelectCoupon:function(e){this.couponList.Data[e].cls?Vue.set(this.couponList.Data[e],"cls",null):Vue.set(this.couponList.Data[e],"cls","active");var o=new Array;for(var e in this.couponList.Data)this.couponList.Data[e].cls&&o.push(this.couponList.Data[e].id);this.joinCouponIds=o.join(",")},submit:function(){console.log(this.model);var e=this;common.ajax({url:config.sendRedPacketUrl,data:e.model,success:function(o){Cookies.set("sendRedPacketName",e.model.sendName,{expires:30}),Cookies.set("sendRedPacketPhoto",e.model.sendPhoto,{expires:30}),wechatSDK.paymentRedPacket(o.data,function(e){e&&(layer.msg("支付成功"),location.href="/red_packet/pages/receive/red_packet.html?id="+o.data)})}})},bindSelectCoupon:function(){this.on="coupon",this.nav.back=!0,this.nav.title="选择展示代金券",0==this.couponList.PageIndex&&this.getCouponList(1)},bindSelectRedPacketCard:function(){this.on="redpacket",this.nav.back=!0,this.nav.title="选择红包名片"},getCouponList:function(e){var o=this;common.ajax({url:config.getCouponListUrl,data:{pageIndex:e},success:function(n){if(1==e)o.couponList=n.data;else{o.couponList.Data.reverse();for(var t in o.couponList.Data)n.data.Data.push(this.couponList.Data[t]);o.couponList.Data.reverse(),n.data.isLoadData=!0,o.couponList=n.data}Vue.set(o,"couponList",o.couponList)}})}}});