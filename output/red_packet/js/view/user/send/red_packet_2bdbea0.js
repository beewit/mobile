var wecatInit=!1;new Vue({el:"#app",data:{on:"index",nav:{back:"false",title:"发红包",rtext:""},index:0,isLoginAccount:!0,model:{sendName:null,sendPhoto:config.defaultPhoto,randomMoney:1},sendPhotoImage:config.defaultPhoto,joinCouponIds:null,blessings:null,remarks:null,money:1,redPacketCardId:null,redPacketCardName:null,feeMoney:0,couponList:{PageIndex:0,Data:null},cardList:{PageIndex:0,Data:null},selectCouponList:null,expireComponyFunc:!0,Loading:!1,arrayRandomMoney:[{id:1,name:"1元"},{id:3,name:"1~3元"},{id:5,name:"1~5元"},{id:10,name:"1~10元"},{id:20,name:"1~20元"},{id:30,name:"1~30元"},{id:50,name:"1~50元"},{id:100,name:"1~100元"},{id:200,name:"1~200元"}]},mounted:function(){var t=this;wechatSDK.initConfig(["chooseImage","uploadImage","previewImage","chooseWXPay"],function(){wecatInit=!0}),common.getToken(function(e){e?common.getEffectiveFuncById(common.redPacketFuncId,function(){t.expireComponyFunc=common.getRedPacketFuncExpireTime()}):t.isLoginAccount=!1})},methods:{backClick:function(){this.on="index",this.nav.back="false",this.nav.title="发红包"},chooseImage:function(){var t=this;return wecatInit?void wechatSDK.chooseImage(1,function(e){t.model.sendPhoto=e.data.path,t.sendPhotoImage=e.data.url},function(){layer.msg("上传失败",{icon:0})}):void layer.msg("刷新页面重试")},changeRandomMoney:function(t){this.model.randomMoney=t,console.log(event)},tapSelectCoupon:function(t){this.couponList.Data[t].cls?Vue.set(this.couponList.Data[t],"cls",null):Vue.set(this.couponList.Data[t],"cls","active");var e=new Array;for(var t in this.couponList.Data)this.couponList.Data[t].cls&&e.push(this.couponList.Data[t].id);this.joinCouponIds=e.join(",")},submit:function(){console.log(this.model);var t=this;common.ajax({url:config.sendRedPacketUrl,data:t.model,success:function(e){Cookies.set("sendRedPacketName",t.model.sendName,{expires:30}),Cookies.set("sendRedPacketPhoto",t.model.sendPhoto,{expires:30}),wechatSDK.paymentRedPacket(e.data,function(t){t&&(layer.msg("支付成功"),location.href="/red_packet/pages/receive/red_packet.html?id="+e.data)})}})},bindSelectCoupon:function(){this.on="coupon",this.nav.back=!0,this.nav.title="选择展示代金券",0==this.couponList.PageIndex&&common.scroll("#content",function(t,e){loadPage=t,that.getCouponList(1,e)},function(t,e){loadPage=t,that.getCouponList(that.couponList.PageIndex+1,e)})},bindSelectRedPacketCard:function(){this.on="redpacket",this.nav.back=!0,this.nav.title="选择红包名片",0==this.cardList.PageIndex&&common.scroll("#content",function(t,e){loadPage=t,that.getCardList(1,e)},function(t,e){loadPage=t,that.getCardList(that.cardList.PageIndex+1,e)})},getCouponList:function(t){var e=this;common.ajax({url:config.getCouponListUrl,data:{pageIndex:t},success:function(a){if(1==t)e.couponList=a.data;else{e.couponList.Data.reverse();for(var n in e.couponList.Data)a.data.Data.push(this.couponList.Data[n]);e.couponList.Data.reverse(),a.data.isLoadData=!0,e.couponList=a.data}Vue.set(e,"couponList",e.couponList)}})},getCardList:function(t,e){var a=this;common.ajax({url:config.getRedPacketCardListUrl,data:{pageIndex:t},success:function(n){if(1==t)a.cardList=n.data;else{a.cardList.Data.reverse();for(var o in a.cardList.Data)n.data.Data.push(a.cardList.Data[o]);n.data.Data.reverse(),a.cardList=n.data}setTimeout(function(){"function"==typeof e&&e(n)},500)},error:function(){setTimeout(function(){"function"==typeof e&&e(null)},500)}})}}});